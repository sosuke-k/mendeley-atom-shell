<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/core-ajax/core-ajax.html">

<polymer-element name="document-service" attributes="documents headers">
  <template>
    <style>
    :host {
      display: none;
    }
    </style>
    <core-ajax id="ajax"
      auto
      method="GET"
      url="https://api.mendeley.com/documents?limit=3"
      headers="{{headers}}"
      contentType="application/vnd.mendeley-document.1+json"
      on-core-response="{{postsLoaded}}"
      on-core-error="{{errorListener}}"
      handleAs="json">
    </core-ajax>
    <!-- <core-ajax id="ajax"
      auto
      method="GET"
      url="./api/documents.json"
      contentType="application/vnd.mendeley-document.1+json"
      on-core-response="{{postsLoaded}}"
      on-core-error="{{errorListener}}"
      handleAs="json"> -->
    </core-ajax>
  </template>
  <script>
  Polymer('document-service', {
    ready: function() {
      var tmp = localStorage["mendeley-access-token"];
      tmp = "MSwxNDIyMzA2MTEzMjI5LDEzMzczOTA0MSw4OTgsYWxsLCxJaHk5VHBDX3lieGZoQ0dYLTZibExsZ0RIOG8";
      this.headers = '{ "Authorization": "Bearer ' + tmp + '", '
        + '"Accept": "application/vnd.mendeley-document.1+json" }';
      console.log("headers:" + this.headers);
    },
    created: function() {
      this.documents = [];
    },
    postsLoaded: function() {
      // Make a copy of the loaded data
      this.documents = this.$.ajax.response.slice(0);
    },
    errorListener: function() {
      console.log("document-service error");
    },
  });
  </script>
</polymer-element>
